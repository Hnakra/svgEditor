<!DOCTYPE html>
<html lang="ru" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>svgEditor - векторный онлайн редактор</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  </head>
  <body>
    <header>
      <p id="logo"><i class="fa fa-chevron-circle-right" aria-hidden="true"></i><b>svgEditor</b></p>
      <div class="top-buttons-group">
        <button id="creature" class="button" onclick="createSVGPanel()">
          <i class="fa fa-plus-square" aria-hidden="true"></i>
        </button>
        <button class="button" onclick="document.getElementById('file-input').click();">
            <input id="file-input" accept="image/svg+xml" type="file" name="name" style="display: none;" />
            <i class="fa fa-folder" aria-hidden="true"></i>
        </button>
        <button id="save" class="button" onclick="saveSVG()">
          <i class="fa fa-download" aria-hidden="true"></i>
        </button>
      </div>
      <div id="selected-instrument-block">
        <b id="selected-instrument-label">Выбранный инструмент:</b>
        <b id="selected-instrument">Курсор </b>
          <b id="selected-counter-label">Выбранных элементов:</b>
          <div id='select-counter'>0</div>
      </div>
      <div id="options">
          <div id="options-line">
              <div class="selector">
                  <span class="selector-label">Толщина линии, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">1</li>
                      <li class="selector-li">2</li>
                      <li class="selector-li">3</li>
                      <li class="selector-li">4</li>
                      <li class="selector-li">5</li>
                      <li class="selector-li">7</li>
                      <li class="selector-li">10</li>
                      <li class="selector-li">13</li>
                      <li class="selector-li">15</li>
                  </ul>
              </div>
              <div class="selector">
                  <span class="selector-label">Длина, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">10</li>
                      <li class="selector-li">50</li>
                      <li class="selector-li">100</li>
                  </ul>
              </div>
          </div>
          <div id="options-text">
              <div class="selector">
                  <span class="selector-label">Шрифт:</span>
                  <input style="width: 70px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">Arial</li>
                      <li class="selector-li">Sans Serif</li>
                      <li class="selector-li">Open Sans</li>
                      <li class="selector-li">Roboto</li>
                  </ul>
              </div>
              <div class="selector">
                  <span class="selector-label">Размер шрифта, pt:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">7</li>
                      <li class="selector-li">10</li>
                      <li class="selector-li">12</li>
                      <li class="selector-li">14</li>
                      <li class="selector-li">18</li>
                      <li class="selector-li">22</li>
                      <li class="selector-li">36</li>
                  </ul>
              </div>
          </div>
          <div id="options-rect">
              <div class="selector">
                  <span class="selector-label">Радиус скругления, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">0</li>
                      <li class="selector-li">5</li>
                      <li class="selector-li">7</li>
                      <li class="selector-li">10</li>
                      <li class="selector-li">13</li>
                      <li class="selector-li">15</li>
                  </ul>
              </div>
              <div class="selector">
                  <span class="selector-label">Высота, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">10</li>
                      <li class="selector-li">50</li>
                      <li class="selector-li">100</li>
                  </ul>
              </div>
              <div class="selector">
                  <span class="selector-label">Ширина, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">10</li>
                      <li class="selector-li">50</li>
                      <li class="selector-li">100</li>
                  </ul>
              </div>
          </div>
          <div id="options-ellipse">
              <div class="selector">
                  <span class="selector-label">Высота, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">10</li>
                      <li class="selector-li">50</li>
                      <li class="selector-li">100</li>
                  </ul>
              </div>
              <div class="selector">
                  <span class="selector-label">Ширина, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">10</li>
                      <li class="selector-li">50</li>
                      <li class="selector-li">100</li>
                  </ul>
              </div>
          </div>
          <div id="options-polygon">
              <div class="selector">
                  <span class="selector-label">Количество углов:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">3</li>
                      <li class="selector-li">4</li>
                      <li class="selector-li">6</li>
                      <li class="selector-li">8</li>
                      <li class="selector-li">10</li>
                      <li class="selector-li">12</li>
                      <li class="selector-li">14</li>
                  </ul>
              </div>
              <div class="selector">
                  <span class="selector-label">Радиус:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">30</li>
                      <li class="selector-li">40</li>
                      <li class="selector-li">60</li>
                      <li class="selector-li">80</li>
                      <li class="selector-li">100</li>
                  </ul>
              </div>
          </div>
          <div id="options-brush">
              <div class="selector">
                  <span class="selector-label">Размер кисти, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" id="brush_width"/>
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">1</li>
                      <li class="selector-li">2</li>
                      <li class="selector-li">3</li>
                      <li class="selector-li">4</li>
                      <li class="selector-li">5</li>
                      <li class="selector-li">7</li>
                      <li class="selector-li">10</li>
                      <li class="selector-li">13</li>
                      <li class="selector-li">15</li>
                  </ul>
              </div>
          </div>
          <div id="options-eraser">
              <div class="selector">
                  <span class="selector-label">Размер ластика, px:</span>
                  <input style="width: 35px;" type="text" class="selector-field" id="eraser_width"/>
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">4</li>
                      <li class="selector-li">5</li>
                      <li class="selector-li">7</li>
                      <li class="selector-li">10</li>
                      <li class="selector-li">13</li>
                      <li class="selector-li">15</li>
                  </ul>
              </div>
          </div>
          <div id="options-zoom">
              <div class="selector">
                  <span class="selector-label">Масштаб:</span>
                  <input style="width: 35px;" type="text" class="selector-field" />
                  <button type="button" class="selector-button"><i style="color: white;" class="fas fa-sort-down"></i></button>
                  <ul class="selector-ul">
                      <li class="selector-li">0.25</li>
                      <li class="selector-li">0.5</li>
                      <li class="selector-li">0.75</li>
                      <li class="selector-li">1</li>
                      <li class="selector-li">1.25</li>
                      <li class="selector-li">1.5</li>
                      <li class="selector-li">2</li>
                      <li class="selector-li">3</li>
                      <li class="selector-li">4</li>
                  </ul>
              </div>
          </div>
      </div>
    </header>
    <main>
      <div id="left-panel">
        <input type="radio" alt="Курсор" id="cursor" name="instruments" checked/>
        <label for="cursor"><i class="fa fa-mouse-pointer"></i></label>
        <input type="radio" alt="Рука" id="hand" name="instruments"/>
        <label for="hand"><i class="fa fa-hand-paper" aria-hidden="true"></i></label>

        <input type="radio" alt="Многоугольник" id="polygon" name="instruments">
        <label for="polygon"><i class="fas fa-star" aria-hidden="true"></i></label>

        <button id="button-color" class="button"><i id="color" class="fa fa-square" aria-hidden="true"></i></button>

          <table>
              <row>

                  <td hidden = "true"><button id="create-group" class="button" >
                      <i class="fa fa-plus-square" aria-hidden="true"></i>G
                  </button></td>
              </row>
          </table>
          <div id="color-picker" class="cp-default">
              <div class="picker-wrapper">
                  <div id="picker" class="picker"></div>
                  <div id="picker-indicator" class="picker-indicator"></div>
              </div>
              <div class="pcr-wrapper">
                  <div id="pcr" class="pcr"></div>
                  <div id="pcr-indicator" class="pcr-indicator"></div>
              </div>
              <ul id="color-values">
                  <div id="pcr_bg"></div>
                  <li><label>RGB:</label><span id="rgb"></span></li>
                  <li><label>HSV:</label><span id="hsv"></span></li>
                  <li><label>HEX:</label><span id="hex"></span></li>
              </ul>
          </div>
      </div>

      <div id="back-panel">
        <div id="draw-panel">
          <svg id="svg-panel" width="900" height="500"
            xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
          </svg>
        </div>
      </div>
    </main>
    <!--Добавлять скрипты под этим комментарием-->
    <script src="js/selector-ui.js"></script>
    <script src="js/lib.js"></script>
    <script src="js/handler.js"></script>
    <script src="js/hand.js"></script>
    <script src="js/Figure.js"></script>
    <script src="js/polygon.js"></script>
    <script src="js/open.js"></script>
    <script src="js/save.js"></script>
    <script src="js/creature.js"></script>
    <script src="js/keyActions.js"></script>
    <script src="js/colorpicker.js"></script>
    <script type="text/javascript">
        cp = ColorPicker(document.getElementById('pcr'), document.getElementById('picker'),
            (hex, hsv, rgb, mousePicker, mousepcr) => {
                currentColor = hex;
                paletteColor = currentColor;
                ColorPicker.positionIndicators(
                    document.getElementById('pcr-indicator'),
                    document.getElementById('picker-indicator'),
                    mousepcr, mousePicker);

                document.getElementById('hex').innerHTML = hex;
                document.getElementById('rgb').innerHTML = 'rgb(' + rgb.r.toFixed() + ',' + rgb.g.toFixed() + ',' + rgb.b.toFixed() + ')';
                document.getElementById('hsv').innerHTML = 'hsv(' + hsv.h.toFixed() + ',' + hsv.s.toFixed(2) + ',' + hsv.v.toFixed(2) + ')';

                document.getElementById('pcr_bg').style.backgroundColor = hex;
                document.getElementById('color').style.color = hex;
            });
        colorPicker.addEventListener('click', () => {
            if (currentFigure !== null) {
                if(currentFigure.groupID == "0") {
                    currentFigure.svgFig.setAttribute('fill', paletteColor);
                } else {

                    let figures = svgPanel.getElementById(currentFigure.groupID).childNodes;
                    for(let i = 0; i < figures.length; i++){
                        figures[i].setAttribute('fill', paletteColor);
                    }
                }
            }
        });
        cp.setHex(paletteColor);

        document.getElementById("create-group").addEventListener('click', ()=>{
            // отменить группировку, если хоть один элемент уже сгруппирован
            for(let i = 0; i < selectedFigures.length; i++){
                if (selectedFigures[i].groupID !== "0"){
                    alert("Группировка невозможна, один из выбранных элементов относится к той или иной группе");
                    return;
                }
            }
            // группировка элементов
            let groups = document.getElementsByTagName("g");
            let groupID = selectedFigures[0].groupID;
            for(let i = 0; i < groups.length; i++) {
                if(groupID < groups[i].getAttribute("id")){
                    groupID = groups[i].getAttribute("id");
                }
            }
            groupID++;


            let group = document.createElementNS(svgNS, "g");
            group.setAttribute("id", groupID);
            for(let i = 0; i < selectedFigures.length; i++){
                selectedFigures[i].groupID = groupID;

                //selectedFigures[i].hideRefPoints();
                svgPanel.removeChild(selectedFigures[i].svgFig);
                group.appendChild(selectedFigures[i].svgFig);
                //selectedFigures[i].hideOrShow();
            }
            selectedFigures = [];
            Figure.refreshSelectedFiguresCounter();
            //svgPanel.insertBefore(group, svgPanel);
            svgPanel.appendChild(group);

        });

    </script>
  </body>
</html>
